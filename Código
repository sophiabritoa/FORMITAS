#include <Wire.h>
#include <LiquidCrystal_I2C.h>

const int pinReedQ = A1;
const int pinReedT = A2;
const int pinReedC = A3;
const int pinReedE = A4;
const int pinReedS = A5;
const int pinReedR = A6;

int ListaRS[] = {pinReedQ, pinReedT, pinReedC, pinReedE, pinReedS, pinReedR};

const int pinBotaoQ = 30;
const int pinBotaoT = 31;
const int pinBotaoC = 32;
const int pinBotaoE = 33;
const int pinBotaoS = 34;
const int pinBotaoR = 35;

int ListaBotao[] = {pinBotaoQ, pinBotaoT, pinBotaoC, pinBotaoE, pinBotaoS, pinBotaoR};

const int ledVermelho = 52;
const int ledVerde = 53;
LiquidCrystal_I2C lcd(0x27, 16, 2);

byte quadrado[8] = {
  B00000,
  B00000,
  B11111,
  B11111,
  B11111,
  B11111,
  B11111,
  B00000,
};

byte triangulo[8] = {
  B00000,
  B00000,
  B00000,
  B00100,
  B01110,
  B11111,
  B00000,
  B00000,
};

byte circulo[8] = {
  B00000,
  B00000,
  B01110,
  B11111,
  B11111,
  B11111,
  B01110,
  B00000,
};

byte seta[8] = {
  B00000,
  B00100,
  B01110,
  B11111,
  B00100,
  B00100,
  B00100,
  B00000,
};

byte retangulo[8] = {
  B00000,
  B01110,
  B01110,
  B01110,
  B01110,
  B01110,
  B01110,
  B00000,
};

byte estrela[8] = {
  B00000,
  B00000,
  B00100,
  B00100,
  B11111,
  B01110,
  B01010,
  B10001,
};

// Change ListaFiguras to a pointer array of byte arrays
byte* ListaFiguras[] = {quadrado, triangulo, circulo, estrela, seta, retangulo};

bool acerto = false; // Declare acerto variable

int lerRS(int* ListaRS) {
  // percorre todos os Reed Switch e retorna a posição do que está LOW (ativado)
  for (int i = 0; i < 6; i++) {
    if (digitalRead(ListaRS[i]) == LOW) { // Use lista instead of pinReed
      return i;
    }
  }
  // caso nenhum deles esteja ativado, retorna -1
  return -1;
}

int lerBotao(int* ListaBotao) {
  // percorre todos os botões e retorna a posição do que está LOW (ativado)
  for (int i = 0; i < 6; i++) {
    if (digitalRead(ListaBotao[i]) == LOW) { // Use lista instead of pinBotao
      return i;
    }
  }
  // caso nenhum deles esteja ativado, retorna -1
  return -1;
}

void setup() {
  for (int i = 0; i < 6; i++) {
    pinMode(ListaRS[i], INPUT_PULLUP);
    pinMode(ListaBotao[i], INPUT_PULLUP);
  }

  pinMode(ledVermelho, OUTPUT);
  pinMode(ledVerde, OUTPUT);

  digitalWrite(ledVermelho, HIGH);
  digitalWrite(ledVerde, LOW);

  lcd.init();       // Inicializa o LCD
  lcd.backlight();  // Liga a luz de fundo
  lcd.clear();
}

void loop() {
  int FE = random(0, 6); // Adjusted to include 5

  while (!acerto) {
    int estadoReed = lerRS(ListaRS);
    int estadoBtn = lerBotao(ListaBotao);

    // se verdadeiro, quer dizer que o reed que a pessoa "pressionou"
    // e o botão são os mesmos que foram sorteados
    if (estadoReed == FE && estadoBtn == FE) {
      // acertou
      digitalWrite(ledVermelho, LOW);
      digitalWrite(ledVerde, HIGH);
      delay(1000);
      lcd.setCursor(1, 0);
      lcd.clear();
      lcd.print("   Parabens!");
      delay(2000);
      lcd.clear();
      acerto = true; // Set acerto to true when the user wins
    } else {
      digitalWrite(ledVermelho, HIGH);
      digitalWrite(ledVerde, LOW);  // errou
    }
  }
}
